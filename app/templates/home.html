<!DOCTYPE html>
<html>

<head>
  <title>Generate Secure URL</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" />
</head>

<body>
  <div class="container mt-5 d-flex flex-row">
    <!-- Sidebar -->
    <div class="col-md-4">
      <div class="bg-light p-3 border rounded">
        <h4>Sidebar</h4>
        <ul class="list-group list-unstyled">
          <li>
            <button class="list-group-item text-center bg-dark text-white w-100" onclick="showComponent('secureUrl')">
              Confidential Chat
            </button>
          </li>
        </ul>

        <h6 class="mt-5">Normal Chats</h6>
        <ul class="list-group list-unstyled">
          <li>
            <button class="list-group-item text-center bg-dark text-white" onclick="showComponent('chatInterface')">
              Receiver
            </button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-8">
      <div id="secureUrl" class="component">
        <h2>Generate Secure URL</h2>
        <hr />
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %} {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endfor %} {% endif %} {% endwith %}
        <form method="POST" action="{{ url_for('generate_url') }}">
          <div class="form-group">
            <label for="data">Data to Secure:</label>
            <textarea class="form-control" id="data" name="data" rows="3" required></textarea>
          </div>
          <div class="form-group">
            <label for="email">Your Email:</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="example@example.com"
              required />
          </div>
          <button type="submit" class="btn btn-primary">
            Generate Secure URL
          </button>
        </form>
        {% if access_url %}
        <div class="alert alert-info mt-3">
          <strong>Access URL:</strong>
          <p>{{ access_url }}</p>
        </div>
        {% endif %}
      </div>

      <div id="chatInterface" class="component d-none">
        <h2>Chat with Reciever</h2>
        <hr />
        <div class="chat-box bg-light p-3 border rounded" id="chat-box">
          <!-- <p><strong>Receiver:</strong> Hi there! How can I help you?</p> -->
          <div class="form-group mt-3">
            <input type="text" class="form-control" id="message-input" placeholder="Type your message..." />
            <button class="btn btn-primary mt-2" onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS for interactivity -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
    integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
    crossorigin="anonymous"></script>

  <!-- JavaScript for toggling components -->
  <script type="text/javascript" charset="utf-8">
    var socket = io();

    function sendMessage() {
      const messageInput = document.getElementById("message-input");
      const message = messageInput.value.trim();

      console.log(socket.id, message);
      if (message) {
        socket.emit("message", { data: message });

        // Optionally append the message to the sender's chat box
        appendMessage("You", message);

        // Clear the input
        messageInput.value = "";
      }
    }

    function showComponent(componentId) {
      // Hide all components
      document.querySelectorAll(".component").forEach((el) => {
        el.classList.add("d-none");
      });

      // Show the selected component
      document.getElementById(componentId).classList.remove("d-none");
    }

    // Append a message to the chat box
    function appendMessage(sender, message) {
      const chatBox = document.getElementById("chat-box");
      const messageElement = document.createElement("p");
      messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
      chatBox.appendChild(messageElement);
      chatBox.scrollTop = chatBox.scrollHeight; // Scroll to the bottom
    }

    // Listen for incoming messages
    socket.on("message", (data) => {
      if (data.sender !== socket.id) {
        appendMessage("Sender", data.data);
      }
    });

  </script>
</body>

</html>